<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pexip Health Consultation</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <script type="text/javascript" src="https://cklab-edges.ck-collab-engtest.com/static/webrtc/js/pexrtc.js"></script>
    <style>
        /* Center the generate button */
        #generate-button-container {
            text-align: center;
            margin-top: 20px;
        }

        #generate-button {
            display: inline-block;
            background-color: #0ebec7;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border-radius: 5px;
        }

        .form-container, .video-container { 
            display: none;
            margin: 10px 0;
        }

        video {
            width: 100%;
            height: 300px;
            background-color: #333;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
<div id="generate-button-container">
    <button id="generate-button">Generate Medical Consultation Alias</button>
    <div id="alias-display"></div>
</div>

<!-- Role Selection Form -->
<div class="form-container" id="role-form">
    <h3>Select Your Role:</h3>
    <button onclick="selectRole('patient')">Patient</button>
    <button onclick="selectRole('provider')">Provider</button>
    <button onclick="selectRole('both')">Both</button>
</div>

<!-- Patient Form -->
<div class="form-container" id="patient-form">
    <label for="patient-name">Enter your name:</label>
    <input type="text" id="patient-name" placeholder="Your Name" required>
    <button onclick="joinConference('guest')">Join as Patient</button>
</div>

<!-- Provider Form -->
<div class="form-container" id="provider-form">
    <label for="provider-select">Select a Provider:</label>
    <select id="provider-select">
        <option value="Dr. JDemo">Dr. JDemo</option>
        <option value="Dr. MDemo">Dr. MDemo</option>
        <option value="Dr. CDemo">Dr. CDemo</option>
    </select>
    <button onclick="joinConference('host')">Join as Provider</button>
</div>

<!-- Video Containers -->
<div class="video-container" id="patient-video">
    <video id="patient-video-element" autoplay controls></video>
</div>

<div class="video-container" id="provider-video">
    <video id="provider-video-element" autoplay controls></video>
</div>

<script>
    // Generate alias function
    function generateAlias() {
        const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
        let alias = 'ph';
        for (let i = 0; i < 15; i++) {
            alias += characters.charAt(Math.floor(Math.random() * characters.length));
        }
        return alias;
    }

    // Show role selection form on button click
    document.getElementById('generate-button').addEventListener('click', () => {
        const alias = generateAlias();
        document.getElementById('alias-display').innerText = `Alias: ${alias}`;
        document.getElementById('role-form').style.display = 'block';
    });

    // Handle role selection and display appropriate form
    function selectRole(role) {
        document.getElementById('role-form').style.display = 'none';
        if (role === 'patient') {
            document.getElementById('patient-form').style.display = 'block';
        } else if (role === 'provider') {
            document.getElementById('provider-form').style.display = 'block';
        } else if (role === 'both') {
            joinConference('both');
        }
    }

    // Start video conference based on role
    function joinConference(role) {
        if (role === 'guest') {
            startVideo('patient-video-element', 'guest');
            document.getElementById('patient-video').style.display = 'block';
        } else if (role === 'host') {
            const providerName = document.getElementById('provider-select').value;
            startVideo('provider-video-element', 'host', providerName);
            document.getElementById('provider-video').style.display = 'block';
        } else if (role === 'both') {
            startVideo('provider-video-element', 'host', 'Provider');
            startVideo('patient-video-element', 'guest');
            document.getElementById('provider-video').style.display = 'block';
            document.getElementById('patient-video').style.display = 'block';
        }
    }

    // Initialize and play video based on role
    function startVideo(videoElementId, role, name = '') {
        const videoElement = document.getElementById(videoElementId);
        const alias = document.getElementById('alias-display').innerText.split(': ')[1];
        const bandwidth = 1280; // Example bandwidth

        const url = `conference.html?alias=${alias}&role=${role}&name=${name}&bandwidth=${bandwidth}`;
        console.log(`Starting ${role} conference: ${url}`);
        
        // Simulate video loading (in a real scenario, you would connect to the actual WebRTC stream)
        videoElement.src = 'img/healthcareGraph2.mp4';  // Placeholder video
    }
</script>

</body>
</html>
