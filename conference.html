<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-us" xml:lang="en-us">
<head>
    <title>Pexip Health</title>
    <link rel="stylesheet" type="text/css" href="style.css" />
    <meta name="robots" content="noindex, nofollow" />
    <script type="text/javascript" src="https://cklab-edges.ck-collab-engtest.com/static/webrtc/js/pexrtc.js"></script>
    <script type="text/javascript" src="webui.js"></script>
    <script type='text/javascript'>
    window.onload = function() {
        var url = window.location.href;
        var params = url.substr(url.indexOf("?")+1).split("&");
        var i;
        var qp = {};
        for (i=0;i<params.length;i++) {
            var kv = params[i].split("=");
            qp[kv[0]] = kv[1];
        }

        // Determine if the user should select a role
        if (!qp['role']) {
            document.getElementById("selectrole").classList.remove("hidden");
        }

        console.log(qp);

        var source = "";
        if ("join_pres" in qp) {
            source = "screen";
        }

        if (qp['role']) {
            if (qp['role'] === "host") {
                document.getElementById("pinentry").classList.remove("hidden");
            } else {
                initialise("cklab-edges.ck-collab-engtest.com", qp['alias'], qp['bandwidth'], qp['name'], "", source);
                checkVideoStream();
            }
        }
    }

    function submitSelectRole() {
        var role = document.querySelector('input[name="role"]:checked').value;
        var alias = ""; // You can pass alias from URL params here if needed
        var bandwidth = ""; // Add bandwidth if necessary
        var name = ""; // Add name if required
        
        if (role === "2") { // Host selected
            document.getElementById("selectrole").classList.add("hidden");
            document.getElementById("pinentry").classList.remove("hidden");
        } else { // Guest selected
            initialise("cklab-edges.ck-collab-engtest.com", alias, bandwidth, name, "", ""); // Initialize guest
            document.getElementById("selectrole").classList.add("hidden");
            checkVideoStream();
        }
    }

    function submitPinEntry() {
        var pin = document.getElementById('id_pin').value;
        var alias = ""; // Same alias logic if needed
        var bandwidth = ""; // Bandwidth if necessary
        var name = ""; // Add name if required
        
        initialise("cklab-edges.ck-collab-engtest.com", alias, bandwidth, name, pin, ""); // Initialize host with PIN
        document.getElementById("pinentry").classList.add("hidden");
        checkVideoStream();
        return false;
    }

    function checkVideoStream() {
        var videoElement = document.getElementById("video");
        var interval = setInterval(function() {
            if (videoElement.srcObject && videoElement.srcObject.active) {
                clearInterval(interval);
                document.getElementById("vitals-container").style.display = "block"; // Show the vitals dashboard
                populateVitals();
                document.getElementById("last-measurements-container").style.display = "block"; // Show the last measurements
                populateLastMeasurements(); // Populate last measurements
            }
        }, 500); // Check every 500ms
    }

    function populateVitals() {
        document.getElementById("vitals-image").src = "img/vitals.gif";
    }

    function updateVitals() {
        document.getElementById("vitals-image").src = "img/vitals.gif";
    }
    </script>

    <meta name="robots" content="NONE,NOARCHIVE" />
    <style>
    /* Styles omitted for brevity, you can retain your original styles */
    </style>
</head>

<body class="home">
<!-- Container -->
<div id="container" class="site">
    <!-- Vitals and Last Measurements sections omitted for brevity -->
    
    <!-- Role Selection -->
    <div id="selectrole" class="main site join hidden">
        <h2>Select your role for this conference:</h2>
        <form>
            <div class="cf">
                <input type="radio" value="1" name="role" id="id_guest" class="webrtcinput" checked>
                <label for="id_guest">Guest</label>
            </div>
            <div class="cf">
                <input type="radio" value="2" name="role" id="id_host" class="webrtcinput">
                <label for="id_host">Host</label>
            </div>
            <input type="button" value="Join Conference" name="join" id="id_join" class="webrtcbutton" onClick="submitSelectRole();">
        </form>
    </div>

    <!-- PIN Entry for Host -->
    <div id="pinentry" class="main site join hidden">
        <form onSubmit="return submitPinEntry();">
            <label for="id_pin" class="vh">Enter the conference PIN</label>
            <input type="password" value="" name="pin" id="id_pin" placeholder="Enter the conference PIN" required class="webrtcinput">
            <input type="button" value="Join Conference" name="join" id="id_join" class="webrtcbutton" onClick="submitPinEntry();">
        </form>
    </div>

    <!-- IVR and Video sections omitted for brevity -->

</div>
<!-- END Container -->

</body>
</html>
